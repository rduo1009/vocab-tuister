// Code generated by mkunion. DO NOT EDIT.
package stream

import (
	"encoding/json"
	"fmt"
	"github.com/widmogrod/mkunion/x/shared"
)

type PullCMDVisitor interface {
	VisitFromBeginning(v *FromBeginning) any
	VisitFromOffset(v *FromOffset) any
}

type PullCMD interface {
	AcceptPullCMD(g PullCMDVisitor) any
}

var (
	_ PullCMD = (*FromBeginning)(nil)
	_ PullCMD = (*FromOffset)(nil)
)

func (r *FromBeginning) AcceptPullCMD(v PullCMDVisitor) any { return v.VisitFromBeginning(r) }
func (r *FromOffset) AcceptPullCMD(v PullCMDVisitor) any    { return v.VisitFromOffset(r) }

func MatchPullCMDR3[T0, T1, T2 any](
	x PullCMD,
	f1 func(x *FromBeginning) (T0, T1, T2),
	f2 func(x *FromOffset) (T0, T1, T2),
) (T0, T1, T2) {
	switch v := x.(type) {
	case *FromBeginning:
		return f1(v)
	case *FromOffset:
		return f2(v)
	}
	var result1 T0
	var result2 T1
	var result3 T2
	return result1, result2, result3
}

func MatchPullCMDR2[T0, T1 any](
	x PullCMD,
	f1 func(x *FromBeginning) (T0, T1),
	f2 func(x *FromOffset) (T0, T1),
) (T0, T1) {
	switch v := x.(type) {
	case *FromBeginning:
		return f1(v)
	case *FromOffset:
		return f2(v)
	}
	var result1 T0
	var result2 T1
	return result1, result2
}

func MatchPullCMDR1[T0 any](
	x PullCMD,
	f1 func(x *FromBeginning) T0,
	f2 func(x *FromOffset) T0,
) T0 {
	switch v := x.(type) {
	case *FromBeginning:
		return f1(v)
	case *FromOffset:
		return f2(v)
	}
	var result1 T0
	return result1
}

func MatchPullCMDR0(
	x PullCMD,
	f1 func(x *FromBeginning),
	f2 func(x *FromOffset),
) {
	switch v := x.(type) {
	case *FromBeginning:
		f1(v)
	case *FromOffset:
		f2(v)
	}
}
func init() {
	shared.JSONMarshallerRegister("github.com/widmogrod/mkunion/x/stream.FromBeginning", FromBeginningFromJSON, FromBeginningToJSON)
	shared.JSONMarshallerRegister("github.com/widmogrod/mkunion/x/stream.FromOffset", FromOffsetFromJSON, FromOffsetToJSON)
	shared.JSONMarshallerRegister("github.com/widmogrod/mkunion/x/stream.PullCMD", PullCMDFromJSON, PullCMDToJSON)
}

type PullCMDUnionJSON struct {
	Type          string          `json:"question_type,omitempty"`
	FromBeginning json.RawMessage `json:"stream.FromBeginning,omitempty"`
	FromOffset    json.RawMessage `json:"stream.FromOffset,omitempty"`
}

func PullCMDFromJSON(x []byte) (PullCMD, error) {
	if x == nil || len(x) == 0 {
		return nil, nil
	}
	if string(x[:4]) == "null" {
		return nil, nil
	}
	var data PullCMDUnionJSON
	err := json.Unmarshal(x, &data)
	if err != nil {
		return nil, fmt.Errorf("stream.PullCMDFromJSON: %w", err)
	}

	switch data.Type {
	case "stream.FromBeginning":
		return FromBeginningFromJSON(data.FromBeginning)
	case "stream.FromOffset":
		return FromOffsetFromJSON(data.FromOffset)
	}

	if data.FromBeginning != nil {
		return FromBeginningFromJSON(data.FromBeginning)
	} else if data.FromOffset != nil {
		return FromOffsetFromJSON(data.FromOffset)
	}
	return nil, fmt.Errorf("stream.PullCMDFromJSON: unknown type: %s", data.Type)
}

func PullCMDToJSON(x PullCMD) ([]byte, error) {
	if x == nil {
		return []byte(`null`), nil
	}
	return MatchPullCMDR2(
		x,
		func(y *FromBeginning) ([]byte, error) {
			body, err := FromBeginningToJSON(y)
			if err != nil {
				return nil, fmt.Errorf("stream.PullCMDToJSON: %w", err)
			}
			return json.Marshal(PullCMDUnionJSON{
				Type:          "stream.FromBeginning",
				FromBeginning: body,
			})
		},
		func(y *FromOffset) ([]byte, error) {
			body, err := FromOffsetToJSON(y)
			if err != nil {
				return nil, fmt.Errorf("stream.PullCMDToJSON: %w", err)
			}
			return json.Marshal(PullCMDUnionJSON{
				Type:       "stream.FromOffset",
				FromOffset: body,
			})
		},
	)
}

func FromBeginningFromJSON(x []byte) (*FromBeginning, error) {
	result := new(FromBeginning)
	err := result.UnmarshalJSON(x)
	if err != nil {
		return nil, fmt.Errorf("stream.FromBeginningFromJSON: %w", err)
	}
	return result, nil
}

func FromBeginningToJSON(x *FromBeginning) ([]byte, error) {
	return x.MarshalJSON()
}

var (
	_ json.Unmarshaler = (*FromBeginning)(nil)
	_ json.Marshaler   = (*FromBeginning)(nil)
)

func (r *FromBeginning) MarshalJSON() ([]byte, error) {
	if r == nil {
		return nil, nil
	}
	return r._marshalJSONFromBeginning(*r)
}
func (r *FromBeginning) _marshalJSONFromBeginning(x FromBeginning) ([]byte, error) {
	partial := make(map[string]json.RawMessage)
	var err error
	var fieldTopic []byte
	fieldTopic, err = r._marshalJSONTopic(x.Topic)
	if err != nil {
		return nil, fmt.Errorf("stream: FromBeginning._marshalJSONFromBeginning: field name Topic; %w", err)
	}
	partial["Topic"] = fieldTopic
	result, err := json.Marshal(partial)
	if err != nil {
		return nil, fmt.Errorf("stream: FromBeginning._marshalJSONFromBeginning: struct; %w", err)
	}
	return result, nil
}
func (r *FromBeginning) _marshalJSONTopic(x Topic) ([]byte, error) {
	result, err := shared.JSONMarshal[Topic](x)
	if err != nil {
		return nil, fmt.Errorf("stream: FromBeginning._marshalJSONTopic:; %w", err)
	}
	return result, nil
}
func (r *FromBeginning) UnmarshalJSON(data []byte) error {
	result, err := r._unmarshalJSONFromBeginning(data)
	if err != nil {
		return fmt.Errorf("stream: FromBeginning.UnmarshalJSON: %w", err)
	}
	*r = result
	return nil
}
func (r *FromBeginning) _unmarshalJSONFromBeginning(data []byte) (FromBeginning, error) {
	result := FromBeginning{}
	var partial map[string]json.RawMessage
	err := json.Unmarshal(data, &partial)
	if err != nil {
		return result, fmt.Errorf("stream: FromBeginning._unmarshalJSONFromBeginning: native struct unwrap; %w", err)
	}
	if fieldTopic, ok := partial["Topic"]; ok {
		result.Topic, err = r._unmarshalJSONTopic(fieldTopic)
		if err != nil {
			return result, fmt.Errorf("stream: FromBeginning._unmarshalJSONFromBeginning: field Topic; %w", err)
		}
	}
	return result, nil
}
func (r *FromBeginning) _unmarshalJSONTopic(data []byte) (Topic, error) {
	result, err := shared.JSONUnmarshal[Topic](data)
	if err != nil {
		return result, fmt.Errorf("stream: FromBeginning._unmarshalJSONTopic: native ref unwrap; %w", err)
	}
	return result, nil
}

func FromOffsetFromJSON(x []byte) (*FromOffset, error) {
	result := new(FromOffset)
	err := result.UnmarshalJSON(x)
	if err != nil {
		return nil, fmt.Errorf("stream.FromOffsetFromJSON: %w", err)
	}
	return result, nil
}

func FromOffsetToJSON(x *FromOffset) ([]byte, error) {
	return x.MarshalJSON()
}

var (
	_ json.Unmarshaler = (*FromOffset)(nil)
	_ json.Marshaler   = (*FromOffset)(nil)
)

func (r *FromOffset) MarshalJSON() ([]byte, error) {
	if r == nil {
		return nil, nil
	}
	return r._marshalJSONFromOffset(*r)
}
func (r *FromOffset) _marshalJSONFromOffset(x FromOffset) ([]byte, error) {
	partial := make(map[string]json.RawMessage)
	var err error
	var fieldTopic []byte
	fieldTopic, err = r._marshalJSONTopic(x.Topic)
	if err != nil {
		return nil, fmt.Errorf("stream: FromOffset._marshalJSONFromOffset: field name Topic; %w", err)
	}
	partial["Topic"] = fieldTopic
	var fieldOffset []byte
	fieldOffset, err = r._marshalJSONPtrOffset(x.Offset)
	if err != nil {
		return nil, fmt.Errorf("stream: FromOffset._marshalJSONFromOffset: field name Offset; %w", err)
	}
	if fieldOffset != nil {
		partial["Offset"] = fieldOffset
	}
	result, err := json.Marshal(partial)
	if err != nil {
		return nil, fmt.Errorf("stream: FromOffset._marshalJSONFromOffset: struct; %w", err)
	}
	return result, nil
}
func (r *FromOffset) _marshalJSONTopic(x Topic) ([]byte, error) {
	result, err := shared.JSONMarshal[Topic](x)
	if err != nil {
		return nil, fmt.Errorf("stream: FromOffset._marshalJSONTopic:; %w", err)
	}
	return result, nil
}
func (r *FromOffset) _marshalJSONPtrOffset(x *Offset) ([]byte, error) {
	if x == nil {
		return nil, nil
	}
	return r._marshalJSONOffset(*x)
}
func (r *FromOffset) _marshalJSONOffset(x Offset) ([]byte, error) {
	result, err := shared.JSONMarshal[Offset](x)
	if err != nil {
		return nil, fmt.Errorf("stream: FromOffset._marshalJSONOffset:; %w", err)
	}
	return result, nil
}
func (r *FromOffset) UnmarshalJSON(data []byte) error {
	result, err := r._unmarshalJSONFromOffset(data)
	if err != nil {
		return fmt.Errorf("stream: FromOffset.UnmarshalJSON: %w", err)
	}
	*r = result
	return nil
}
func (r *FromOffset) _unmarshalJSONFromOffset(data []byte) (FromOffset, error) {
	result := FromOffset{}
	var partial map[string]json.RawMessage
	err := json.Unmarshal(data, &partial)
	if err != nil {
		return result, fmt.Errorf("stream: FromOffset._unmarshalJSONFromOffset: native struct unwrap; %w", err)
	}
	if fieldTopic, ok := partial["Topic"]; ok {
		result.Topic, err = r._unmarshalJSONTopic(fieldTopic)
		if err != nil {
			return result, fmt.Errorf("stream: FromOffset._unmarshalJSONFromOffset: field Topic; %w", err)
		}
	}
	if fieldOffset, ok := partial["Offset"]; ok {
		result.Offset, err = r._unmarshalJSONPtrOffset(fieldOffset)
		if err != nil {
			return result, fmt.Errorf("stream: FromOffset._unmarshalJSONFromOffset: field Offset; %w", err)
		}
	}
	return result, nil
}
func (r *FromOffset) _unmarshalJSONTopic(data []byte) (Topic, error) {
	result, err := shared.JSONUnmarshal[Topic](data)
	if err != nil {
		return result, fmt.Errorf("stream: FromOffset._unmarshalJSONTopic: native ref unwrap; %w", err)
	}
	return result, nil
}
func (r *FromOffset) _unmarshalJSONPtrOffset(data []byte) (*Offset, error) {
	if len(data) == 0 {
		return nil, nil
	}
	if string(data[:4]) == "null" {
		return nil, nil
	}
	result, err := r._unmarshalJSONOffset(data)
	if err != nil {
		return nil, fmt.Errorf("stream: FromOffset._unmarshalJSONPtrOffset: pointer; %w", err)
	}
	return &result, nil
}
func (r *FromOffset) _unmarshalJSONOffset(data []byte) (Offset, error) {
	result, err := shared.JSONUnmarshal[Offset](data)
	if err != nil {
		return result, fmt.Errorf("stream: FromOffset._unmarshalJSONOffset: native ref unwrap; %w", err)
	}
	return result, nil
}
